<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë¦¬ ê¼¼ê¼¼ì´ì˜ ëŒ€ì¶œ ìƒê° ë‚˜ëˆ„ê¸°</title>
    <style>
        :root { --primary: #0071e3; --bg: #f5f5f7; --card: #ffffff; --text: #1d1d1f; --red: #ff3b30; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .card { background: var(--card); padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 550px; position: relative; }
        .character-area { position: absolute; top: -10px; left: -20px; z-index: 20; transform: rotate(-15deg); }
        .char-icon { font-size: 50px; margin-bottom: -15px; margin-left: 25px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2)); }
        .owner-badge { background: #ffcc00; color: #000; padding: 8px 35px; font-size: 16px; font-weight: 900; border: 2px solid #000; border-radius: 5px; box-shadow: 3px 3px 0px #000; }
        
        h2 { text-align: center; margin-top: 50px; font-size: 22px; color: #1d1d1f; }
        
        .tab-container { display: flex; background: #f2f2f7; padding: 4px; border-radius: 12px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: bold; color: #86868b; transition: 0.2s; }
        .tab.active { background: white; color: #000; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .section { background: #f9f9fb; border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid #efeff4; }
        .input-group { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .input-group:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }

        label { display: block; margin-bottom: 10px; font-weight: 700; font-size: 15px; color: #333; }
        input { width: 100%; padding: 14px; border: 1px solid #d2d2d7; border-radius: 12px; font-size: 17px; box-sizing: border-box; outline: none; background: white; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0,113,227,0.1); }
        
        .ko-read { font-size: 13px; color: var(--primary); margin-top: 8px; font-weight: 700; border-left: 3px solid var(--primary); padding-left: 10px; min-height: 18px; }
        .income-report { background: #eef7ff; padding: 12px; border-radius: 10px; margin-top: 10px; font-size: 13px; color: #0056b3; font-weight: bold; border: 1px solid #cce5ff; }

        .btn-detail { width: 100%; padding: 12px; background: #f2f2f7; border: none; border-radius: 12px; color: var(--primary); font-weight: bold; cursor: pointer; margin-bottom: 15px; font-size: 14px; }
        
        .dual-input { display: flex; align-items: center; gap: 10px; }
        .dual-input input[type="range"] { flex: 1; }
        .dual-input input[type="number"] { width: 80px; text-align: center; }

        .result-box { background: #1d1d1f; color: white; padding: 25px; border-radius: 20px; margin-top: 10px; }
        .highlight { color: #00d2ff; font-weight: 800; font-size: 26px; }
        .sub-label { color: #aaa; font-size: 12px; }

        .reverse-box { background: #2c2c2e; padding: 15px; border-radius: 12px; margin-top: 15px; border: 1px solid #444; }
        
        .schedule-toggle { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .schedule-area { margin-top: 15px; overflow-x: auto; max-height: 350px; border: 1px solid #eee; font-size: 11px; }
        table { width: 100%; border-collapse: collapse; min-width: 400px; }
        th { background: #f2f2f7; padding: 10px; position: sticky; top: 0; border-bottom: 2px solid #d2d2d7; color: black; }
        td { padding: 10px; border-bottom: 1px solid #efeff4; text-align: right; }
        .passed-row { background: #fff9e6; color: #d4a017; font-weight: bold; }
        
        .email-btn { width: 100%; padding: 15px; background: #5856d6; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .hidden { display: none !important; }
        .footer { text-align: center; font-size: 12px; color: #86868b; margin-top: 25px; padding-bottom: 20px; }

        /* [ì¶”ê°€] ê²½ê³  ë¬¸êµ¬ ìŠ¤íƒ€ì¼ */
        .warning-msg { color: var(--red); font-size: 13px; font-weight: bold; margin-top: 8px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <div class="character-area"><div class="char-icon">ğŸ‘§</div><div class="owner-badge">ê¼¼ê¼¼ì´</div></div>
    <h2>ğŸ  ì£¼íƒë‹´ë³´ ëŒ€ì¶œí•œë„ ë¯¸ë¦¬ë³´ê¸°</h2>

    <div class="tab-container">
        <div id="tab-non" class="tab active" onclick="switchTab('non')">ë¬´ì†Œë“(ì¹´ë“œ)</div>
        <div id="tab-worker" class="tab" onclick="switchTab('worker')">ì§ì¥ì¸(ì—°ë´‰)</div>
    </div>

    <div class="section">
        <div class="input-group">
            <label id="income-label">ì—°ê°„ ì¹´ë“œ ì‚¬ìš©ì•¡ (ë§Œì›)</label>
            <input type="number" id="incomeInput" value="2500" oninput="calculate()">
            <div id="incomeKo" class="ko-read"></div>
            <div id="estIncomeReport" class="income-report">ì€í–‰ 55% ì¸ì • ì¶”ì • ì—°ì†Œë“: ì•½ 4,545ë§Œ ì›</div>
        </div>
        
        <div class="input-group">
            <label>ë‹´ë³´ ì£¼íƒ ê°€ê²© (ë§Œì›)</label>
            <input type="number" id="housePrice" value="50000" oninput="calculate()">
            <div id="houseKo" class="ko-read"></div>
        </div>
        
        <div class="input-group">
            <label>ê¸°ë³¸ ëŒ€ì¶œ ê¸ˆë¦¬ (%)</label>
            <input type="number" id="rate" value="4.5" step="0.1" oninput="calculate()">
        </div>
    </div>

    <button class="btn-detail" onclick="toggleDetail()">ğŸ” ë” ìì„¸í•œ ì„¤ì • (ê¸°ê°„/ê±°ì¹˜/ìƒí™©ì²´í¬)</button>

    <div id="detail-section" class="hidden">
        <div class="section">
            <label>ëŒ€ì¶œ ìƒí™˜ ê¸°ê°„ (ë…„)</label>
            <div class="dual-input">
                <input type="range" id="termRange" min="1" max="50" value="30" oninput="syncTerm('range')">
                <input type="number" id="termNum" value="30" oninput="syncTerm('num')">
                <span style="font-weight:bold; font-size:14px;">ë…„</span>
            </div>
            <div class="input-group" style="margin-top:20px; border-bottom:none;">
                <label>ê±°ì¹˜ ê¸°ê°„ (ì´ìë§Œ ë‚´ëŠ” ê°œì›”ìˆ˜)</label>
                <input type="number" id="graceMonths" value="0" oninput="calculate()">
            </div>
            <div class="input-group" style="border-bottom:none;">
                <label>!!(í•„ìˆ˜) ê¸°ì¡´ì— ë°›ì€ ë‹¤ë¥¸ ëŒ€ì¶œ ìƒí™˜ì¤‘ì¸ ê¸ˆì•¡ ì ê¸°(ì—°ê°„/ë§Œì›)</label>
                <input type="number" id="existingLoan" value="0" oninput="calculate()">
                <div id="existingKo" class="ko-read"></div>
            </div>
            <div style="color: #d70000; font-weight: bold; font-size: 13px; background:#fff2f2; padding:12px; border-radius:12px;">
                <input type="checkbox" id="stressCheck" onchange="calculate()"> ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ë°˜ì˜ (+1.2%)
            </div>
        </div>

        <div class="section" style="border: 2px dashed #0071e3; background: #f0f7ff;">
            <label>ğŸ“Š ì§€ê¸ˆ ë‚´ ìƒí™©ì€? (ê²½ê³¼ í™•ì¸)</label>
            <input type="number" id="passedMonths" placeholder="ì§€ê¸ˆê¹Œì§€ ëª‡ íšŒì°¨ ê°šìœ¼ì…¨ë‚˜ìš”?" oninput="calculate()">
            <div id="progressReport" style="font-size:13px; margin-top:10px; line-height:1.6; color:#0056b3;"></div>
        </div>
    </div>

    <div class="result-box">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
            <span class="sub-label">ìµœì¢… ëŒ€ì¶œ í•œë„ (DSRÂ·LTV ìµœì €ê°’)</span>
            <span id="maxLimitText" class="highlight">0 ë§Œì›</span>
        </div>
        <div id="maxKo" style="text-align:right; font-size:13px; color:#00d2ff; font-weight:bold; margin-bottom:15px;"></div>
        
        <div style="border-top:1px solid #444; padding-top:15px; margin-top:5px;">
            <label style="color:#00d2ff; font-size:12px;">ğŸ’¸ ì‹¤ì œ ë¹Œë¦¬ê³  ì‹¶ì€ ê¸ˆì•¡ (ë§Œì›)</label>
            <input type="number" id="applyAmount" value="20000" oninput="calculate()" style="background:#333; color:white; border:1px solid #555; width:100%; padding:10px; border-radius:8px;">
            <div id="applyKo" class="ko-read" style="color:#00d2ff; border-left-color:#00d2ff;"></div>
            <div id="limitWarning" class="warning-msg">âš ï¸ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤! í¬ë§ ê¸ˆì•¡ì„ ë‚®ì¶°ë³´ì„¸ìš”.</div>
        </div>

        <div id="repayDetail" style="margin-top:15px; font-size:14px; line-height:1.8;"></div>

        <div class="reverse-box">
            <label style="color:#ffcc00; font-size:12px;">ğŸ“… ì—­ì‚°: ë§¤ë‹¬ ì´ ì •ë„ë§Œ ê°šëŠ”ë‹¤ë©´?(ë‹¨ìœ„ :ë§Œì›)</label>
            <input type="number" id="myAbility" value="150" oninput="calculate()" style="background:#444; color:white; border:none; width:100%; padding:10px; border-radius:6px; margin-top:5px;">
            <div id="reverseResult" style="margin-top:10px; color:#ffcc00; font-weight:bold; font-size:14px; line-height:1.4;"></div>
        </div>
    </div>

    <button class="schedule-toggle" onclick="toggleSchedule()">ğŸ—“ï¸ ìƒí™˜ ìŠ¤ì¼€ì¤„í‘œ (ì”ì•¡ í™•ì¸í•˜ê¸°)</button>
    <div id="scheduleArea" class="schedule-area hidden">
        <table>
            <thead><tr><th>íšŒì°¨</th><th>ì›ë¦¬ê¸ˆ</th><th>ì›ê¸ˆ</th><th>ì´ì</th><th>ì”ì•¡</th></tr></thead>
            <tbody id="scheduleBody"></tbody>
        </table>
    </div>

    <button class="email-btn" onclick="shareThoughts()">âœ‰ï¸ ì´ ê²°ê³¼ ê³µìœ í•˜ê³  ì˜ê²¬ ë‚˜ëˆ„ê¸°</button>

    <div class="footer"><b>ë¯¸ë¦¬ ê¼¼ê¼¼ì´ì™€ í•¨ê»˜í•˜ëŠ” ëŒ€ì¶œ ìˆ˜ë‹¤</b></div>
</div>

<script>
let currentMode = 'non';

function convertKo(n) {
    if(!n || n==0) return "0ì›";
    let ok = Math.floor(n/10000); let man = Math.floor(n%10000);
    return (ok > 0 ? ok + "ì–µ " : "") + (man > 0 ? man.toLocaleString() + "ë§Œ" : "") + " ì›";
}

function switchTab(m) {
    currentMode = m;
    document.getElementById('tab-non').className = m === 'non' ? 'tab active' : 'tab';
    document.getElementById('tab-worker').className = m === 'worker' ? 'tab active' : 'tab';
    document.getElementById('income-label').innerText = m === 'non' ? 'ì—°ê°„ ì¹´ë“œ ì‚¬ìš©ì•¡ (ë§Œì›)' : 'ë³¸ì¸ ì„¸ì „ ì—°ë´‰ (ë§Œì›)';
    calculate();
}

function syncTerm(from) {
    const r = document.getElementById('termRange'); const n = document.getElementById('termNum');
    if(from === 'range') n.value = r.value; else r.value = n.value;
    calculate();
}

function toggleDetail() { document.getElementById('detail-section').classList.toggle('hidden'); }
function toggleSchedule() { document.getElementById('scheduleArea').classList.toggle('hidden'); }

function calculate() {
    const rawIncome = parseFloat(document.getElementById('incomeInput').value) || 0;
    let income = currentMode === 'non' ? (rawIncome / 0.55) : rawIncome;
    
    const estBox = document.getElementById('estIncomeReport');
    if(currentMode === 'non') {
        estBox.classList.remove('hidden');
        estBox.innerText = `ì€í–‰ ì¸ì • ì¶”ì • ì—°ì†Œë“: ì•½ ${convertKo(Math.floor(income))}`;
    } else {
        estBox.classList.add('hidden');
    }

    let baseRate = parseFloat(document.getElementById('rate').value) || 0;
    if(document.getElementById('stressCheck').checked) baseRate += 1.2;
    
    const r = (baseRate / 100) / 12;
    const n = (parseInt(document.getElementById('termNum').value) || 1) * 12;
    const grace = parseInt(document.getElementById('graceMonths').value) || 0;
    const applyMan = parseFloat(document.getElementById('applyAmount').value) || 0;
    const existing = parseFloat(document.getElementById('existingLoan').value) || 0;

    document.getElementById('incomeKo').innerText = "ì…ë ¥ê¸ˆì•¡: " + convertKo(rawIncome);
    document.getElementById('houseKo').innerText = "ì…ë ¥ê¸ˆì•¡: " + convertKo(document.getElementById('housePrice').value);
    document.getElementById('existingKo').innerText = "ì…ë ¥ê¸ˆì•¡: " + convertKo(existing);
    document.getElementById('applyKo').innerText = "ì…ë ¥ê¸ˆì•¡: " + convertKo(applyMan);

    const dsrLimit = r > 0 ? ((income * 0.4 - existing) / 12) * ((1 - Math.pow(1 + r, -(n - grace))) / r) : 0;
    const ltvLimit = (document.getElementById('housePrice').value || 0) * 0.7;
    const finalMax = Math.max(0, Math.min(dsrLimit, ltvLimit));
    
    document.getElementById('maxLimitText').innerText = Math.floor(finalMax).toLocaleString() + " ë§Œì›";
    document.getElementById('maxKo').innerText = "ìµœì¢… í•œë„: ì•½ " + convertKo(Math.floor(finalMax));

    /* [ì¶”ê°€ëœ í•œë„ ì²´í¬ ë¡œì§] */
    const warningMsg = document.getElementById('limitWarning');
    const applyKo = document.getElementById('applyKo');
    if (applyMan > finalMax && finalMax > 0) {
        warningMsg.style.display = 'block';
        applyKo.style.color = '#ff3b30';
        applyKo.style.borderLeftColor = '#ff3b30';
    } else {
        warningMsg.style.display = 'none';
        applyKo.style.color = '#00d2ff';
        applyKo.style.borderLeftColor = '#00d2ff';
    }

    const repayDiv = document.getElementById('repayDetail');
    const body = document.getElementById('scheduleBody');
    body.innerHTML = "";
    
    if(applyMan > 0 && r > 0) {
        const monthlyRepay = (applyMan * 10000 * r * Math.pow(1 + r, n - grace)) / (Math.pow(1 + r, n - grace) - 1);
        if(grace > 0) {
            repayDiv.innerHTML = `<div style="display:flex; justify-content:space-between;"><span>ê±°ì¹˜ ì¤‘(ì´ì)</span><span>${Math.floor(applyMan*10000*r).toLocaleString()} ì›</span></div>
                                 <div style="display:flex; justify-content:space-between;"><span>ê±°ì¹˜ í›„(ì›ë¦¬ê¸ˆ)</span><span style="color:#ff3b30; font-weight:bold;">${Math.floor(monthlyRepay).toLocaleString()} ì›</span></div>`;
        } else {
            repayDiv.innerHTML = `<div style="display:flex; justify-content:space-between;"><span>ë§¤ë‹¬ ìƒí™˜í•  ëˆ</span><span style="color:#ff3b30; font-weight:bold;">${Math.floor(monthlyRepay).toLocaleString()} ì›</span></div>`;
        }

        let bal = applyMan * 10000;
        let cumInt = 0;
        const passed = parseInt(document.getElementById('passedMonths').value) || 0;

        for(let i=1; i<=n; i++) {
            let int = bal * r;
            let pri = (i <= grace) ? 0 : monthlyRepay - int;
            bal -= pri;
            cumInt += int;
            let row = document.createElement('tr');
            if(i === passed) row.className = "passed-row";
            row.innerHTML = `<td>${i}íšŒ</td><td>${Math.floor(i<=grace?int:monthlyRepay).toLocaleString()}</td><td>${Math.floor(pri).toLocaleString()}</td><td>${Math.floor(int).toLocaleString()}</td><td>${Math.floor(Math.max(0, bal)).toLocaleString()}</td>`;
            body.appendChild(row);
            if(i === passed) {
                document.getElementById('progressReport').innerHTML = `ğŸ“Œ <b>í˜„ì¬ ì§„í–‰ ë¦¬í¬íŠ¸</b><br>ë‚¨ì€ ë¹š: <b>${convertKo(Math.floor(bal/10000))}</b><br>ì§€ê¸ˆê¹Œì§€ ë‚¸ ì´ìë§Œ: <b>${convertKo(Math.floor(cumInt/10000))}</b>`;
            }
        }
        if(!passed) document.getElementById('progressReport').innerHTML = "";
    }

    const abilityM = (parseFloat(document.getElementById('myAbility').value) || 0) * 10000;
    const revRes = document.getElementById('reverseResult');
    if(applyMan > 0 && abilityM > (applyMan * 10000 * r)) {
        const revN = -Math.log(1 - (applyMan * 10000 * r) / abilityM) / Math.log(1 + r);
        const ry = Math.floor(revN/12); const rm = Math.ceil(revN%12);
        revRes.innerHTML = `â” ${ry}ë…„ ${rm}ê°œì›” í›„ ë¹š íƒˆì¶œ!<br>(ì´ ì´ì ì˜ˆìƒ: ${convertKo(Math.floor((abilityM*revN - applyMan*10000)/10000))})`;
    } else if(applyMan > 0) {
        revRes.innerHTML = "âš ï¸ ë‚´ëŠ” ëˆì´ ì´ìë³´ë‹¤ ì ì–´ìš”!";
    }
}

function shareThoughts() {
    const email = prompt("ì´ ê³„ì‚° ê²°ê³¼ë¥¼ í•¨ê»˜ ë³´ê³  ì‹¶ì€ ë¶„ì˜ ì´ë©”ì¼ì´ë‚˜ ë³¸ì¸ì˜ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:");
    if(email) {
        alert("ì„±ê³µì ìœ¼ë¡œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì¦ê²ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ ë³´ì„¸ìš”. ğŸ˜Š");
    }
}

calculate();
</script>
</body>
</html>